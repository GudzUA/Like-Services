generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma" // –ú–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ prisma-–∑–≤ º—è–∑–∫–∏ –±–µ–∑ foreign keys
}

//
// üßë –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á (–ú–∞–π—Å—Ç–µ—Ä –∞–±–æ –ö–ª—ñ—î–Ω—Ç)
//
model User {
  id        String  @id @default(cuid())
  email     String  @unique
  name      String?
  phone     String  @unique
  address   String?
  photoUrl   String?
  masterType   String?
  isMaster  Boolean @default(false) // true —è–∫—â–æ –º–∞–π—Å—Ç–µ—Ä
  type      String  // client / moderator / admin

  // üîó –ó–≤ º—è–∑–∫–∏
  services   Service[]  @relation("MasterServices")   // –ú–∞–π—Å—Ç–µ—Ä –º–æ–∂–µ –º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø–æ—Å–ª—É–≥
  timeSlots  TimeSlot[] @relation("UserTimeSlots")    // –°–ª–æ—Ç–∏ –º–∞–π—Å—Ç—Ä–∞
  bookings   Booking[]  @relation("UserBookings")     // –ó–∞–ø–∏—Å–∏ –∫–ª—ñ—î–Ω—Ç–∞
  subtypes  Subtype[] 
  tasks     Task[]   @relation("MasterTasks")
}

//
// ‚úÇÔ∏è –ü–æ—Å–ª—É–≥–∞ (–Ω–∞–ø—Ä. "–°—Ç—Ä–∏–∂–∫–∞")
// –ú–æ–∂–µ –º–∞—Ç–∏ –∫—ñ–ª—å–∫–∞ –ø—ñ–¥—Ç–∏–ø—ñ–≤: "–ñ—ñ–Ω–æ—á–∞", "–ß–æ–ª–æ–≤—ñ—á–∞"
//
model Service {
  id      String @id @default(cuid())
  name    String
  type    String 
  masters  User[]    @relation("MasterServices") // –ü–æ—Å–ª—É–≥–∞ –Ω–∞–ª–µ–∂–∏—Ç—å –º–∞–π—Å—Ç—Ä–∞–º
  subtypes Subtype[] // –ú–∞—î –ø—ñ–¥—Ç–∏–ø–∏
}

//
// üßæ –ü—ñ–¥—Ç–∏–ø –ø–æ—Å–ª—É–≥–∏ (–Ω–∞–ø—Ä. "–ñ—ñ–Ω–æ—á–∞ —Å—Ç—Ä–∏–∂–∫–∞")
// –ú–∞—î —Ü—ñ–Ω—É —ñ —Ç—Ä–∏–≤–∞–ª—ñ—Å—Ç—å
//
model Subtype {
  id         String   @id @default(cuid())
  name       String
  price      Int      // CAD
  duration   Int      // —Ö–≤–∏–ª–∏–Ω

  service    Service  @relation(fields: [serviceId], references: [id])
  serviceId  String

  master     User     @relation(fields: [masterId], references: [id]) // üÜï –¥–æ–¥–∞—î–º–æ –∑–≤ º—è–∑–æ–∫
  masterId   String                                             // üÜï –∑–æ–≤–Ω—ñ—à–Ω—ñ–π –∫–ª—é—á

  bookings   Booking[] @relation("SubtypeBookings") // –ó–∞–ø–∏—Å–∏ –Ω–∞ —Ü–µ–π –ø—ñ–¥—Ç–∏–ø
}

//
// üïë –°–ª–æ—Ç —á–∞—Å—É ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –¥–ª—è –∑–∞–ø–∏—Å—É
//
model TimeSlot {
  id        String   @id @default(cuid())
  start     DateTime // –ü–æ—á–∞—Ç–æ–∫ —Å–ª–æ—Ç—É
  end       DateTime // –ö—ñ–Ω–µ—Ü—å (–∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≥–µ–Ω–µ—Ä—É—î—Ç—å—Å—è –∑ duration)
  master    User?     @relation("UserTimeSlots", fields: [masterId], references: [id])
  masterId  String?

  booking   Booking? // –Ø–∫—â–æ —Ö—Ç–æ—Å—å –∑–∞–±—Ä–æ–Ω—é–≤–∞–≤ ‚Äî —Ç—É—Ç –±—É–¥–µ –∑–∞–ø–∏—Å
}

//
// üìå –ó–∞–ø–∏—Å –Ω–∞ –ø–æ—Å–ª—É–≥—É —É —Å–ª–æ—Ç—ñ
//
model Booking {
  id          String    @id @default(cuid())
  user        User      @relation("UserBookings", fields: [userId], references: [id])
  userId      String

  subtype     Subtype   @relation("SubtypeBookings", fields: [subtypeId], references: [id])
  subtypeId   String

  timeSlot    TimeSlot? @relation(fields: [timeSlotId], references: [id])
  timeSlotId  String?   @unique // –û–¥–∏–Ω —Å–ª–æ—Ç = –º–∞–∫—Å–∏–º—É–º –æ–¥–∏–Ω –∑–∞–ø–∏—Å

  createdAt   DateTime  @default(now())
}

model Task {
  id        String   @id @default(cuid())
  category  String   // –ö–∞—Ç–µ–≥–æ—Ä—ñ—è: "–ß–æ–ª–æ–≤—ñ–∫ –Ω–∞ –≥–æ–¥–∏–Ω—É", "–†–µ–º–æ–Ω—Ç —Ç–µ–ª–µ—Ñ–æ–Ω—É", —Ç–æ—â–æ
  details   String   // –û–ø–∏—Å –∑–∞–≤–¥–∞–Ω–Ω—è
  price     Int?     // –ë–∞–∂–∞–Ω–∞ —Ü—ñ–Ω–∞ (–º–æ–∂–µ –±—É—Ç–∏ null)
  flexible  Boolean  // true = –º–∞–π—Å—Ç–µ—Ä —Å–∞–º –ø—Ä–∏–∑–Ω–∞—á–∏—Ç—å —Ü—ñ–Ω—É
  name      String   // –Ü–º º—è –∫–ª—ñ—î–Ω—Ç–∞
  phone     String   // –¢–µ–ª–µ—Ñ–æ–Ω
  master     User?   @relation("MasterTasks", fields: [masterId], references: [id])
  masterId   String? 
  createdAt DateTime @default(now())
}

